<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C4T — Risk Management Terminal</title>
    
    <meta name="keywords" content="C4T, calculator 4 traders, risk management, position size calculator, trading terminal, калькулятор трейдера, расчет лота, управление рисками">
    <meta name="description" content="Professional Risk Management Terminal for traders. Global tool for position sizing and risk control.">
    
    <link rel="icon" type="image/png" href="logo.png">
    <meta property="og:title" content="C4T — Smart Risk Management">
    <meta property="og:image" content="https://calculator4traders.github.io/logo.png">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        body { background: #0f1a30; color: white; font-family: 'Trebuchet MS', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .calculator { 
            width: 300px; background: #1e2b47; padding: 20px; z-index: 10; 
            border-right: 1px solid #3a4f7a; flex-shrink: 0; overflow-y: auto; 
        }
        .calculator::-webkit-scrollbar { width: 4px; display: block; }
        .calculator::-webkit-scrollbar-thumb { background: #3a4f7a; border-radius: 10px; }
        
        /* Стиль для логотипа в модальном окне */
        .modal-content img {
            width: 100px;
            height: 100px;
            border-radius: 22px;
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .commission-warning { color: #ff9800; font-size: 12px; margin-bottom: 15px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #8a9ab5; margin-bottom: 5px; text-transform: uppercase; }
        input, select { 
            width: 100%; background: #0f1a30; border: 1px solid #3a4f7a; 
            color: white; padding: 8px; border-radius: 4px; box-sizing: border-box; 
        }
        .results { 
            margin-top: 20px; padding: 15px; background: #0f1a30; 
            border-radius: 8px; border: 1px solid #2962ff; 
        }
        .result-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .result-value { color: #00e676; font-weight: bold; }
        
        .chart-container { flex-grow: 1; position: relative; background: #0b1222; cursor: crosshair; }
        .price-line { stroke-width: 2; cursor: ns-resize; }
        .label-bg { fill: rgba(0,0,0,0.7); }
        .label-text { fill: white; font-size: 12px; font-weight: bold; }
        
        .info-icon {
            position: absolute; top: 10px; right: 10px; background: #1e2b47;
            color: #8a9ab5; width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid #3a4f7a; z-index: 100; font-weight: bold;
        }
        .info-icon:hover { color: white; border-color: #2962ff; }
        
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: #1e2b47; padding: 30px; border-radius: 12px;
            max-width: 400px; text-align: center; border: 1px solid #3a4f7a;
        }
        #qrcode { display: flex; justify-content: center; margin: 20px 0; }
        .close-modal {
            margin-top: 20px; background: #2962ff; color: white;
            border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="calculator">
    <div class="commission-warning">Binance Futures (0.02% / 0.05%)</div>
    
    <div class="input-group">
        <label>Balance (USDT)</label>
        <input type="number" id="balance" value="1000">
    </div>
    <div class="input-group">
        <label>Risk (%)</label>
        <input type="number" id="risk" value="1" step="0.1">
    </div>
    <div class="input-group">
        <label>Leverage</label>
        <input type="number" id="leverage" value="10">
    </div>
    
    <div class="results">
        <div class="result-item"><span>Risk Amount:</span> <span class="result-value" id="res-risk-usdt">10.00</span></div>
        <div class="result-item"><span>Position Size:</span> <span class="result-value" id="res-pos-size">0.00</span></div>
        <div class="result-item"><span>Margin Req:</span> <span class="result-value" id="res-margin">0.00</span></div>
        <div class="result-item"><span>Risk/Reward:</span> <span class="result-value" id="res-rr">1:2.0</span></div>
    </div>
</div>

<div class="chart-container" id="chart">
    <div class="info-icon" id="infoBtn">i</div>
</div>

<div class="modal" id="infoModal">
    <div class="modal-content">
        <img src="logo.png" alt="C4T Logo">
        <h3>C4T Terminal</h3>
        <p style="font-size: 13px; color: #8a9ab5;">Professional Risk Management Tool</p>
        <div id="qrcode"></div>
        <p style="font-size: 11px; color: #5c6d8a;">Scan to open on mobile</p>
        <button class="close-modal" id="closeModal">CLOSE</button>
    </div>
</div>

<script>
    // --- ЗАПУТАННАЯ ЗАЩИТА И ЛОГИКА ПРИВЯЗКИ ---
    (function(_0x1a2b,_0x3c4d){const _0x5e6f=window;const _0x7a8b=btoa('Y2FsY3VsYXRvcjR0cmFkZXJzLmdpdGh1Yi5pbw==');if(_0x5e6f['location']['hostname']!==atob(_0x7a8b)){_0x5e6f['document']['body']['innerHTML']='<div style="background:#0b1222;color:#f44336;padding:100px;text-align:center;font-family:sans-serif;"><h1>ACCESS DENIED</h1><p>This software is licensed only for: '+atob(_0x7a8b)+'</p></div>';throw new Error('Unauthorized');}})(window);

    // Основные переменные терминала
    let balance = 1000, riskPercent = 1, leverage = 10;
    let entryPrice = 50000, stopLoss = 49500, takeProfit = 51000;
    let yDomain = [48000, 52000];
    let visibleCount = 100;

    const svg = d3.select("#chart").append("svg").attr("width", "100%").attr("height", "100%");
    const margin = { top: 20, right: 80, bottom: 20, left: 20 };

    function updateCalculations() {
        balance = +document.getElementById('balance').value;
        riskPercent = +document.getElementById('risk').value;
        leverage = +document.getElementById('leverage').value;

        const riskUsdt = balance * (riskPercent / 100);
        const priceDiff = Math.abs(entryPrice - stopLoss);
        const posSize = priceDiff !== 0 ? riskUsdt / (priceDiff / entryPrice) : 0;
        const marginReq = posSize / leverage;
        const rr = Math.abs((takeProfit - entryPrice) / (entryPrice - stopLoss)).toFixed(1);

        document.getElementById('res-risk-usdt').innerText = riskUsdt.toFixed(2);
        document.getElementById('res-pos-size').innerText = posSize.toFixed(2);
        document.getElementById('res-margin').innerText = marginReq.toFixed(2);
        document.getElementById('res-rr').innerText = `1:${rr}`;
    }

    function draw() {
        svg.selectAll("*").remove();
        const rect = svg.node().getBoundingClientRect();
        const width = rect.width, height = rect.height;
        const chartW = width - margin.left - margin.right;
        
        const yScale = d3.scaleLinear().domain(yDomain).range([height - margin.bottom, margin.top]);

        // Сетка
        svg.append("g").attr("transform", `translate(${width - margin.right},0)`)
           .call(d3.axisRight(yScale).ticks(10).tickSize(-chartW).tickFormat(d3.format(".0f")))
           .attr("color", "#1e2b47").selectAll("text").attr("color", "#8a9ab5");

        const lines = [
            { id: 'tp', price: takeProfit, color: '#00e676', label: 'Take Profit' },
            { id: 'entry', price: entryPrice, color: '#2962ff', label: 'Entry' },
            { id: 'sl', price: stopLoss, color: '#ff1744', label: 'Stop Loss' }
        ];

        lines.forEach(line => {
            const y = yScale(line.price);
            const g = svg.append("g").attr("class", "price-line-group");

            g.append("line").attr("class", "price-line")
                .attr("x1", margin.left).attr("x2", width - margin.right)
                .attr("y1", y).attr("y2", y).attr("stroke", line.color)
                .call(d3.drag().on("drag", (e) => {
                    const newPrice = yScale.invert(e.y);
                    if (line.id === 'tp') takeProfit = newPrice;
                    else if (line.id === 'entry') entryPrice = newPrice;
                    else if (line.id === 'sl') stopLoss = newPrice;
                    updateCalculations();
                    draw();
                }));

            g.append("rect").attr("class", "label-bg")
                .attr("x", width - margin.right + 5).attr("y", y - 10)
                .attr("width", 70).attr("height", 20).attr("rx", 4);

            g.append("text").attr("class", "label-text")
                .attr("x", width - margin.right + 10).attr("y", y + 4)
                .text(Math.round(line.price));
        });
    }

    // Обработчики событий
    window.addEventListener("resize", draw);
    document.querySelectorAll('input').forEach(i => i.addEventListener('input', updateCalculations));

    // Модальное окно и QR
    const modal = document.getElementById("infoModal");
    const infoBtn = document.getElementById("infoBtn");
    const closeBtn = document.getElementById("closeModal");

    infoBtn.onclick = () => {
        modal.style.display = "flex";
        document.getElementById("qrcode").innerHTML = "";
        new QRCode(document.getElementById("qrcode"), {
            text: window.location.href,
            width: 128, height: 128,
            colorDark: "#ffffff", colorLight: "#1e2b47"
        });
    };
    closeBtn.onclick = () => modal.style.display = "none";

    // Зум и перетаскивание графика
    let isDragging = false, isPriceScaling = false;
    svg.on("mousedown", (e) => {
        const rect = svg.node().getBoundingClientRect();
        if (e.clientX - rect.left > rect.width - margin.right) isPriceScaling = true;
        else isDragging = true;
    });

    window.addEventListener("mousemove", (e) => {
        if (isPriceScaling) {
            const factor = e.movementY * 0.5;
            yDomain = [yDomain[0] - factor, yDomain[1] + factor];
            draw();
        } else if (isDragging) {
            const range = yDomain[1] - yDomain[0];
            const shift = (e.movementY / 500) * range;
            yDomain = [yDomain[0] + shift, yDomain[1] + shift];
            draw();
        }
    });

    window.addEventListener("mouseup", () => { isDragging = false; isPriceScaling = false; });

    // Стартовая инициализация
    updateCalculations();
    draw();
</script>

</body>
</html>